<template>
   <div 
      class="flex flex-col items-center justify-start gap-7 
      pt-[var(--tg-safe-area-inset-top,env(safe-area-inset-top,0px))] 
      pr-[var(--tg-safe-area-inset-right,env(safe-area-inset-right,0px))] 
      pb-[var(--tg-safe-area-inset-bottom,env(safe-area-inset-bottom,0px))] 
      pl-[var(--tg-safe-area-inset-left,env(safe-area-inset-left,0px))] 
      mt-[0px] mb-[125px] overflow-auto max-h-fit" id="content_app"
   >
      <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å—Ç—Ä–∞–Ω–∏—Ü—ã -->
      <p class="w-full text-h2 font-semibold text-start">–ù–æ–≤–æ—Å—Ç–∏</p>
      
      <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –≤—Å–µ—Ö –Ω–æ–≤–æ—Å—Ç–µ–π -->
      <div class="flex flex-col justify-center items-center gap-[14px] w-full">
         <!-- –ö–∞—Ä—Ç–æ—á–∫–∞ –Ω–æ–≤–æ—Å—Ç–∏ -->
         <div
         v-for="(item, index) in news"
         :key="index"
         class="w-full rounded-[20px] p-[15px] flex flex-col justify-between box-border gap-[15px]"
         style="background: linear-gradient(162deg, var(--color-light-gray) 0%, var(--color-dark-gray) 100%);"
         >
         <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –Ω–æ–≤–æ—Å—Ç–∏ -->
         <p class="text-edit-text1 font-medium">{{ item.title }}</p>
         
         <!-- –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ –Ω–æ–≤–æ—Å—Ç–∏ -->
         <p class="text-[15px] font-normal">{{ item.content }}</p>
         
         <!-- –ò—Å—Ç–æ—á–Ω–∏–∫ –Ω–æ–≤–æ—Å—Ç–∏ -->
         <p 
            v-if="item.source !== 't.me/cryptover1'" 
            class="text-[14px] font-normal text-[var(--support-text-color)]"
         >
            {{ item.source }}
         </p>
         
         <!-- –ò—Å—Ç–æ—á–Ω–∏–∫-—Å—Å—ã–ª–∫–∞ –¥–ª—è –∫—Ä–∏–ø—Ç–æ–≤–µ—Ä–∞ -->
         <a 
            href="https://t.me/cryptover1" 
            v-if="item.source == 't.me/cryptover1'" 
            class="text-[14px] font-normal underline text-[#008EFA]"
         >
            t.me/cryptover1
         </a>
         </div>
      </div>
  </div>
</template>

<script setup lang="ts">
import { ref, onMounted } from 'vue'
import axios from 'axios'

const news = ref<any[]>(
   [
      {
         "title": "$GOVNO Challenge: —Ä–µ–∞–ª—å–Ω—ã–µ –¥–µ–Ω—å–≥–∏ –∑–∞ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ –ø–æ—Ç–µ—Ä–∏",
         "content": "–°—Ç–∞—Ä—Ç–∞–ø $GOVNO VR –ø—Ä–æ–≤–æ–¥–∏—Ç –µ–∂–µ–º–µ—Å—è—á–Ω—ã–π –∫–æ–Ω–∫—É—Ä—Å –¥–ª—è —Ç—Ä–µ–π–¥–µ—Ä–æ–≤ –≤ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–π —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏. –£—á–∞—Å—Ç–Ω–∏–∫–∏ —Å—Ç–∞–ª–∫–∏–≤–∞—é—Ç—Å—è —Å —Å–∏–º—É–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ —Å—Ü–µ–Ω–∞—Ä–∏—è–º–∏ –∫—Ä–∏–ø—Ç–æ-–∫—Ä–∏–∑–∏—Å–æ–≤. –ü–æ–±–µ–∂–¥–∞–µ—Ç —Ç–æ—Ç, –∫—Ç–æ –º–∏–Ω–∏–º–∏–∑–∏—Ä—É–µ—Ç –ø–æ—Ç–µ—Ä–∏, –ø–æ–ª—É—á–∞—è —Ä–µ–∞–ª—å–Ω—ã–µ $GOVNO –≤ –∫–∞—á–µ—Å—Ç–≤–µ –ø—Ä–∏–∑–∞.",
         "source": "CryptoSim Games Blog"
      },
      {
         "title": "$GOVNO –∑–∞–ø—É—Å–∫–∞–µ—Ç '–ë–ª–æ–∫—á–µ–π–Ω –±–µ–∑ –ø—Ä–∏–∫—Ä–∞—Å'",
         "content": "–ù–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç $GOVNO –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω—É—é –º–æ–¥–µ–ª—å –±–ª–æ–∫—á–µ–π–Ω–∞, –≥–¥–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —è–≤–ª—è—é—Ç—Å—è –ø—É–±–ª–∏—á–Ω—ã–º–∏ –∏ –≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä—É–µ–º—ã–º–∏ –≤—Å–µ–º–∏ —É—á–∞—Å—Ç–Ω–∏–∫–∞–º–∏ —Å–µ—Ç–∏, –æ–±–µ—Å–ø–µ—á–∏–≤–∞—è –∞–±—Å–æ–ª—é—Ç–Ω—É—é –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å –∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Å–∫—Ä—ã—Ç—ã—Ö —Å–±–æ—Ä–æ–≤.",
         "source": "TransparentChain Community"
      },
      {
         "title": "–£—Ç–µ—á–∫–∞ –∫–æ–¥–∞ –≤ DAO $GOVNO —Ä–∞—Å–∫—Ä—ã–ª–∞ —É—è–∑–≤–∏–º–æ—Å—Ç–∏",
         "content": "–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π –±–∞–≥ –æ–±–Ω–∞—Ä—É–∂–µ–Ω –≤ –∫–æ–¥–µ $GOVNO DAO, –±–ª–∞–≥–æ–¥–∞—Ä—è —É—Ç–µ—á–∫–µ –Ω–∞ GitHub. –£—è–∑–≤–∏–º–æ—Å—Ç—å –ø–æ–∑–≤–æ–ª—è–ª–∞ –∑–ª–æ—É–º—ã—à–ª–µ–Ω–Ω–∏–∫–∞–º –º–∞–Ω–∏–ø—É–ª–∏—Ä–æ–≤–∞—Ç—å –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è–º–∏. –†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∏ —É—Å—Ç—Ä–∞–Ω—è—é—Ç –ø—Ä–æ–±–ª–µ–º—É, –æ–±—â–µ—Å—Ç–≤–æ —Ç—Ä–µ–±—É–µ—Ç –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏–π.",
         "source": "LeakTech News"
      },
      {
         "title": "TON –Ω–∞ –∫–æ–ª–µ–Ω—è—Ö: $GOVNO –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç–∞ –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç —Ä–æ—Å—Ç –≤ 300%",
         "content": "–í–Ω–µ–∑–∞–ø–Ω—ã–π —Ä–æ—Å—Ç –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç—ã $GOVNO –Ω–∞ 300% –≤—ã–∑–≤–∞–ª —à–æ–∫ —É –∏–Ω–≤–µ—Å—Ç–æ—Ä–æ–≤ TON –ø–æ—Å–ª–µ —Ç–æ–≥–æ, –∫–∞–∫ –ü–∞–≤–µ–ª –î—É—Ä–æ–≤ —Å–ª—É—á–∞–π–Ω–æ –ª–∞–π–∫–Ω—É–ª —Ç–≤–∏—Ç –æ —Å—Ç—Ä–µ–º–∏—Ç–µ–ª—å–Ω–æ–º —Ä–æ—Å—Ç–µ $GOVNO, —á—Ç–æ –ø–æ–¥–Ω—è–ª–æ –≤–æ–ª–Ω—É –∏–Ω—Ç–µ—Ä–µ—Å–∞ –∫ –º–æ–Ω–µ—Ç–µ.",
         "source": "CryptoCrunch App"
      },
      {
         "title": "$GOVNO —Ç–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –∑–∞–ø—Ä–∞–≤–ª—è—Ç—å –∞–≤—Ç–æ –≤ –°–∏–Ω–≥–∞–ø—É—Ä–µ",
         "content": "–ó–∞–ø—É—Å–∫ –Ω–æ–≤–æ–π —É—Å–ª—É–≥–∏ –≤ –°–∏–Ω–≥–∞–ø—É—Ä–µ –ø–æ–∑–≤–æ–ª—è–µ—Ç –∞–≤—Ç–æ–≤–ª–∞–¥–µ–ª—å—Ü–∞–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç—É $GOVNO –¥–ª—è –æ–ø–ª–∞—Ç—ã —Ç–æ–ø–ª–∏–≤–∞ –Ω–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö —Å—Ç–∞–Ω—Ü–∏—è—Ö. –≠—Ç–æ –ø–µ—Ä–≤—ã–π –≤ –º–∏—Ä–µ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –∫—Ä–∏–ø—Ç–æ –Ω–∞ –ê–ó–°.",
         "source": "FuelCrypto Station Blog"
      },
      {
         "title": "–ò–Ω–≤–µ—Å—Ç–æ—Ä—ã –±—Ä–æ—Å–∏–ª–∏ —Ñ–∏–∞—Ç –∑–∞ $GOVNO",
         "content": "–ù–æ–≤—ã–π —Ç—Ä–µ–Ω–¥ —Å—Ä–µ–¥–∏ –∏–Ω–≤–µ—Å—Ç–æ—Ä–æ–≤ - –æ–±–º–µ–Ω —Ñ–∏–∞—Ç–Ω—ã—Ö –≤–∞–ª—é—Ç –Ω–∞ –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç—É $GOVNO. –£–≤–µ–ª–∏—á–µ–Ω–∏–µ –æ–±–æ—Ä–æ—Ç–∞ –º–æ–Ω–µ—Ç—ã –Ω–∞ 150% –ø–æ—Å–ª–µ–¥–Ω–∏–π –º–µ—Å—è—Ü –≥–æ–≤–æ—Ä–∏—Ç –æ –Ω–∞—á–∞–ª–µ –Ω–æ–≤–æ–π —ç—Ä—ã –≤ –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏—è—Ö.",
         "source": "InvestFuture Web"
      },
      {
         "title": "$GOVNO Kits: DIY –Ω–∞–±–æ—Ä –¥–ª—è –∫—Ä–∏–ø—Ç–æ-—Ñ–µ—Ä–º–µ—Ä–æ–≤",
         "content": "–ö–æ–º–ø–∞–Ω–∏—è $GOVNO –∑–∞–ø—É—Å–∫–∞–µ—Ç –Ω–∞–±–æ—Ä—ã –¥–ª—è —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ–π —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∫—Ä–∏–ø—Ç–æ-—Ñ–µ—Ä–º –Ω–∞ –¥–æ–º–∞—à–Ω–∏—Ö –ü–ö, –ø–æ–∑–≤–æ–ª—è—è –∫–∞–∂–¥–æ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é —Å—Ç–∞—Ç—å —á–∞—Å—Ç—å—é –º–∞–π–Ω–∏–Ω–≥–æ–≤–æ–π —Å–µ—Ç–∏ –±–µ–∑ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–≥–æ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è.",
         "source": "HomeMiner Forum"
      },
   
   ]
)

const CACHE_KEY = 'news'
const DATE_KEY = 'news_update_date'

function getToday(): string {
  return new Date().toISOString().split('T')[0]
}

async function fetchNews(forceUpdate = false) {
  const raw = localStorage.getItem(CACHE_KEY)
  const savedDate = localStorage.getItem(DATE_KEY)
  const today = getToday()

  let cached = null
  try {
    cached = raw ? JSON.parse(raw) : null
  } catch (e) {
    console.warn('‚ö†Ô∏è –ü–æ–≤—Ä–µ–∂–¥—ë–Ω–Ω—ã–π JSON –≤ localStorage')
    localStorage.removeItem(CACHE_KEY)
  }

  if (!forceUpdate && cached && savedDate === today) {
    news.value = cached
    console.log('üì¶ –ù–æ–≤–æ—Å—Ç–∏ –∏–∑ localStorage')
    return
  }

  try {
    const tgUserId = window.Telegram?.WebApp?.initDataUnsafe?.user?.id ?? ''
    const { data } = await axios.get(`/api/news/get_news?user_id=${tgUserId}`)
    news.value = data.news
    localStorage.setItem(CACHE_KEY, JSON.stringify(data.news))
    localStorage.setItem(DATE_KEY, data.date || today)
    console.log('üÜï –ù–æ–≤–æ—Å—Ç–∏ —Å —Å–µ—Ä–≤–µ—Ä–∞')
  } catch (e) {
    console.error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –Ω–æ–≤–æ—Å—Ç–µ–π:', e)
  }
}

onMounted(() => {
  fetchNews()
})
</script>